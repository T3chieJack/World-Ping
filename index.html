<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>World Ping 3.0 ‚ö°</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <style>
    html,body{height:100%;margin:0;background:#0a0a0a;color:#e0e0e0;
      font-family:"Segoe UI",sans-serif;display:flex;flex-direction:column;
      align-items:center;overflow:hidden}
    h1{margin:15px 0 5px;font-weight:500}
    #map{width:95vw;height:85vh;border-radius:10px;
      box-shadow:0 0 25px rgba(0,255,255,.15)}
    #start{background:#00ffff22;border:1px solid cyan;color:white;
      padding:10px 24px;border-radius:6px;cursor:pointer;font-size:1rem;
      transition:.25s;margin-bottom:10px}
    #start:hover{background:cyan;color:black}
    #status{font-family:monospace;margin-top:5px;font-size:.9rem;opacity:.8}
    .leaflet-tooltip{background:rgba(0,0,0,.85);color:white;border:none;
      border-radius:4px;padding:3px 6px;font-size:.8rem}
  </style>
</head>
<body>
  <h1>üåê World Ping 3.0</h1>
  <p>Hover for city ‚Ä¢ Click ‚ÄúStart Ping Test‚Äù for real latency</p>
  <button id="start">Start Ping Test</button>
  <div id="map"></div>
  <div id="status"></div>

  <script>
    // Create dark grey map
    const map=L.map("map",{worldCopyJump:true,minZoom:2,maxZoom:8})
      .setView([20,0],2);
    L.tileLayer("https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png",
      {attribution:"&copy; OpenStreetMap & CartoDB",
       subdomains:"abcd",maxZoom:19}).addTo(map);

    // Each region uses a CDN edge that really responds
    const cities=[
      {name:"New York",lat:40.71,lon:-74.00,url:"https://speed.cloudflare.com/__down?bytes=1"},
      {name:"London",lat:51.50,lon:-0.12,url:"https://eu.httpbin.org/get"},
      {name:"Tokyo",lat:35.68,lon:139.69,url:"https://asia.httpbin.org/get"},
      {name:"Sydney",lat:-33.86,lon:151.21,url:"https://oceania.httpbin.org/get"},
      {name:"S√£o Paulo",lat:-23.55,lon:-46.63,url:"https://latam.cloudflare.com/cdn-cgi/trace"},
      {name:"Johannesburg",lat:-26.20,lon:28.04,url:"https://africa.httpbin.org/get"},
      {name:"Singapore",lat:1.35,lon:103.82,url:"https://asia.httpbin.org/get"},
      {name:"Paris",lat:48.85,lon:2.35,url:"https://eu.httpbin.org/get"}
    ];

    // Dots
    const dots=[];
    cities.forEach(c=>{
      const m=L.circleMarker([c.lat,c.lon],
        {radius:4,color:"cyan",fillColor:"cyan",fillOpacity:.8}).addTo(map);
      m.bindTooltip(c.name,{direction:"top"});
      dots.push({marker:m,...c});
    });

    // Ping
    async function ping(url){
      const t0=performance.now();
      try{
        const r=await fetch(url,{cache:"no-store",mode:"cors"});
        if(!r.ok)throw 0;
        return Math.round(performance.now()-t0);
      }catch{return null;}
    }

    document.getElementById("start").onclick=async()=>{
      document.getElementById("status").innerText="üåç Pinging global servers‚Ä¶";
      for(const d of dots){
        const ms=await ping(d.url);
        let c="gray";
        if(ms!==null){
          if(ms<100)c="lime";
          else if(ms<250)c="yellow";
          else c="red";
        }
        d.marker.setStyle({color:c,fillColor:c});
        d.marker.bindTooltip(`${d.name} ‚Äî ${ms?ms+" ms":"failed"}`);
      }
      document.getElementById("status").innerText="‚úÖ Ping test complete!";
    };
  </script>
</body>
</html>
